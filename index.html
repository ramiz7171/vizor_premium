<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vizor Premium</title>
    <style>
        :root {
            /* Light Mode Colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --surface-primary: rgba(255, 255, 255, 0.95);
            --surface-secondary: rgba(255, 255, 255, 0.8);
            --surface-glass: rgba(255, 255, 255, 0.25);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            --border-primary: #e2e8f0;
            --border-secondary: #cbd5e1;
            --shadow-color: rgba(15, 23, 42, 0.04);
            --shadow-strong: rgba(15, 23, 42, 0.1);
            
            /* Brand Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-warning: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
            --gradient-error: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            
            /* Advanced Shadows */
            --shadow-xs: 0 1px 2px 0 var(--shadow-color);
            --shadow-sm: 0 1px 3px 0 var(--shadow-color), 0 1px 2px -1px var(--shadow-color);
            --shadow-md: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color);
            --shadow-lg: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);
            --shadow-xl: 0 20px 25px -5px var(--shadow-strong), 0 8px 10px -6px var(--shadow-color);
            --shadow-2xl: 0 25px 50px -12px var(--shadow-strong);
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            /* Dark Mode Colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --surface-primary: rgba(30, 41, 59, 0.95);
            --surface-secondary: rgba(51, 65, 85, 0.8);
            --surface-glass: rgba(255, 255, 255, 0.05);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --text-muted: #64748b;
            --border-primary: #334155;
            --border-secondary: #475569;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-strong: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: var(--transition-normal);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-container {
            width: 100%;
            max-width: 1600px;
            background: var(--surface-primary);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-2xl);
            overflow: hidden;
            position: relative;
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }

        .header {
            padding: 4rem 4rem 2rem;
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(255,255,255,0.03) 2deg, transparent 4deg);
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .theme-toggle {
            position: absolute;
            top: 2rem;
            right: 2rem;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .theme-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.875rem;
            font-weight: 500;
            user-select: none;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--surface-glass);
            border-radius: 15px;
            border: 1px solid var(--border-primary);
            cursor: pointer;
            transition: var(--transition-normal);
            backdrop-filter: blur(10px);
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: var(--gradient-accent);
            border-radius: 12px;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-md);
        }

        [data-theme="dark"] .toggle-switch::before {
            transform: translateX(30px);
            background: var(--gradient-secondary);
        }

        .toggle-switch:hover {
            box-shadow: var(--shadow-lg);
            transform: scale(1.05);
        }

        .app-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: -0.04em;
            line-height: 1.1;
        }

        .app-subtitle {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
            font-weight: 400;
            opacity: 0.9;
        }

        .content-area {
            padding: 4rem;
        }

        .workspace-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem;
            margin-bottom: 4rem;
        }

        .workspace-panel {
            background: var(--surface-secondary);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--border-primary);
            overflow: hidden;
            transition: var(--transition-slow);
            position: relative;
        }

        .workspace-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-accent);
            opacity: 0;
            transition: var(--transition-normal);
            pointer-events: none;
        }

        .workspace-panel:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-2xl);
            border-color: var(--border-secondary);
        }

        .workspace-panel:hover::before {
            opacity: 0.03;
        }

        .workspace-panel.auto-sort {
            background: linear-gradient(135deg, var(--surface-secondary) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .panel-header {
            padding: 2rem 2rem 1rem;
            position: relative;
        }

        .panel-title {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .auto-sort .panel-title {
            background: var(--gradient-success);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .column-workspace {
            padding: 0 2rem 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .column-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--surface-glass);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
            transition: var(--transition-normal);
        }

        .column-indicator {
            width: 12px;
            height: 12px;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .column-indicator.primary {
            background: var(--gradient-primary);
            box-shadow: 0 0 20px rgba(102, 126, 241, 0.4);
        }

        .column-indicator.secondary {
            background: var(--gradient-secondary);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }

        .column-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.02em;
        }

        .input-field {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            background: var(--bg-primary);
            border: 2px solid var(--border-primary);
            border-radius: 16px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 0.8rem;
            line-height: 1.4;
            color: var(--text-primary);
            resize: vertical;
            transition: var(--transition-normal);
            outline: none;
            box-shadow: var(--shadow-sm);
        }

        .input-field:focus {
            border-color: rgba(102, 126, 241, 0.6);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 4px rgba(102, 126, 241, 0.1),
                inset 0 0 0 1px rgba(102, 126, 241, 0.1);
            transform: scale(1.01);
        }

        .input-field.primary:focus {
            border-color: rgba(102, 126, 241, 0.6);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 4px rgba(102, 126, 241, 0.1);
        }

        .input-field.secondary:focus {
            border-color: rgba(245, 158, 11, 0.6);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 4px rgba(245, 158, 11, 0.1);
        }

        .input-field.auto-sorted {
            background: linear-gradient(135deg, var(--bg-primary) 0%, rgba(16, 185, 129, 0.02) 100%);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--text-primary);
            font-weight: 500;
        }

        .input-field:read-only {
            cursor: default;
            user-select: all;
        }

        .action-bar {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 4rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            min-width: 180px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-primary);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition-normal);
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-tertiary {
            background: var(--surface-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-secondary);
        }

        .results-area {
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition-slow);
            pointer-events: none;
        }

        .results-area.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .metric-card {
            background: var(--surface-secondary);
            backdrop-filter: blur(20px);
            padding: 2.5rem 2rem;
            border-radius: 24px;
            border: 1px solid var(--border-primary);
            text-align: center;
            transition: var(--transition-slow);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: var(--transition-normal);
        }

        .metric-card:hover::before {
            transform: scaleX(1);
        }

        .metric-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-xl);
            border-color: var(--border-secondary);
        }

        .metric-card.success::before {
            background: var(--gradient-success);
        }

        .metric-card.warning::before {
            background: var(--gradient-warning);
        }

        .metric-card.error::before {
            background: var(--gradient-error);
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1;
            letter-spacing: -0.02em;
        }

        .metric-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .comparison-panel {
            background: var(--surface-secondary);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--border-primary);
            overflow: hidden;
            margin-bottom: 4rem;
            box-shadow: var(--shadow-lg);
        }

        .comparison-header {
            padding: 2.5rem 3rem;
            background: var(--surface-glass);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-primary);
        }

        .comparison-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .comparison-content {
            padding: 2rem;
        }

        .comparison-row {
            display: grid;
            grid-template-columns: auto 2fr 2fr auto;
            gap: 1.5rem;
            align-items: center;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .comparison-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            border-radius: 0 3px 3px 0;
        }

        .comparison-row:hover {
            transform: scale(1.01);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-secondary);
        }

        .comparison-row.match::before {
            background: var(--gradient-success);
        }

        .comparison-row.partial-match::before {
            background: var(--gradient-warning);
        }

        .comparison-row.mismatch::before {
            background: var(--gradient-error);
        }

        .comparison-row.missing {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.02) 100%);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .comparison-row.missing::before {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .row-index {
            font-weight: 700;
            color: var(--text-tertiary);
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
            padding: 1rem;
            background: var(--surface-glass);
            border-radius: 12px;
            border: 1px solid var(--border-primary);
        }

        .data-container {
            background: var(--surface-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 1rem;
        }

        .data-container.source {
            border-color: rgba(102, 126, 241, 0.2);
            background: rgba(102, 126, 241, 0.02);
        }

        .data-container.target {
            border-color: rgba(16, 185, 129, 0.2);
            background: rgba(16, 185, 129, 0.02);
        }

        .data-header {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            text-align: center;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .data-cell {
            padding: 0.75rem;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-primary);
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-all;
            transition: var(--transition-fast);
        }

        .data-cell:hover {
            background: var(--surface-glass);
            transform: scale(1.02);
        }

        .data-cell.primary {
            border-left: 4px solid rgba(102, 126, 241, 0.6);
        }

        .data-cell.secondary {
            border-left: 4px solid rgba(245, 158, 11, 0.6);
        }

        .status-indicator {
            font-size: 2rem;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: var(--surface-glass);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
        }

        .export-panel {
            background: var(--surface-glass);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--border-primary);
            padding: 3rem;
            text-align: center;
        }

        .export-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .footer {
            padding: 3rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-primary);
            background: var(--surface-glass);
            backdrop-filter: blur(15px);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .workspace-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .comparison-row {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1.5rem;
            }

            .content-area {
                padding: 3rem;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .header {
                padding: 3rem 2rem 1.5rem;
            }

            .content-area {
                padding: 2rem;
            }

            .column-workspace {
                grid-template-columns: 1fr;
                padding: 0 1.5rem 2rem;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            .action-bar {
                flex-direction: column;
                align-items: center;
            }

            .action-btn {
                width: 100%;
                max-width: 300px;
            }

            .data-grid {
                grid-template-columns: 1fr;
            }

            .export-grid {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .theme-toggle {
                top: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="main-container">
            <header class="header">
                <div class="theme-toggle">
                    <span class="theme-label">Switch Mode</span>
                    <div class="toggle-switch" onclick="toggleTheme()"></div>
                </div>
                <div class="header-content">
                    <h1 class="app-title">Vizor Premium</h1>
                    <p class="app-subtitle">AI Data Intelligence Platform</p>
                </div>
            </header>

            <main class="content-area">
                <div class="workspace-grid">
                    <div class="workspace-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Source Data</h3>
                        </div>
                        <div class="column-workspace">
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator primary"></div>
                                    <span class="column-label">Column 1</span>
                                </div>
                                <textarea id="sourceCol1" class="input-field primary" onpaste="setTimeout(() => cleanTextarea('sourceCol1'), 10)"></textarea>
                            </div>
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator secondary"></div>
                                    <span class="column-label">Column 2</span>
                                </div>
                                <textarea id="sourceCol2" class="input-field secondary" onpaste="setTimeout(() => cleanTextarea('sourceCol2'), 10)"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="workspace-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Target Data</h3>
                        </div>
                        <div class="column-workspace">
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator primary"></div>
                                    <span class="column-label">Column 1</span>
                                </div>
                                <textarea id="targetCol1" class="input-field primary" onpaste="setTimeout(() => cleanTextarea('targetCol1'), 10)"></textarea>
                            </div>
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator secondary"></div>
                                    <span class="column-label">Column 2</span>
                                </div>
                                <textarea id="targetCol2" class="input-field secondary" onpaste="setTimeout(() => cleanTextarea('targetCol2'), 10)"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="workspace-panel auto-sort">
                        <div class="panel-header">
                            <h3 class="panel-title">Auto-Sorted Target</h3>
                        </div>
                        <div class="column-workspace">
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator primary"></div>
                                    <span class="column-label">Column 1</span>
                                </div>
                                <textarea id="autoSortedCol1" class="input-field auto-sorted" readonly></textarea>
                            </div>
                            <div class="column-section">
                                <div class="column-header">
                                    <div class="column-indicator secondary"></div>
                                    <span class="column-label">Column 2</span>
                                </div>
                                <textarea id="autoSortedCol2" class="input-field auto-sorted" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <button onclick="autoSortTarget()" class="action-btn btn-primary">Auto-Sort Target</button>
                    <button onclick="compareData()" class="action-btn btn-secondary">Analyze Data</button>
                    <button onclick="clearData()" class="action-btn btn-tertiary">Reset Workspace</button>
                </div>

                <div class="results-area" id="results">
                    <div class="metrics-grid" id="metricsGrid"></div>
                    
                    <div class="comparison-panel">
                        <div class="comparison-header">
                            <h3 class="comparison-title">Detailed Analysis Results</h3>
                        </div>
                        <div class="comparison-content" id="comparisonContent"></div>
                    </div>

                    <div class="export-panel">
                        <div class="export-grid">
                            <button onclick="copyComparisonResults()" class="action-btn btn-tertiary">Export Results</button>
                            <button onclick="copyAutoSortedData()" class="action-btn btn-tertiary">Export Auto-Sorted</button>
                            <button onclick="copyMismatchesOnly()" class="action-btn btn-tertiary">Export Mismatches</button>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <p>Crafted by <strong>Ramiz</strong> • Powered by Advanced Analytics</p>
            </footer>
        </div>
    </div>

    <script>
        let comparisonData = {};

        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        function cleanTextarea(textareaId) {
            const textarea = document.getElementById(textareaId);
            const originalValue = textarea.value;
            
            const cleanedLines = originalValue
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            const cleanedValue = cleanedLines.join('\n');
            
            if (originalValue !== cleanedValue) {
                textarea.value = cleanedValue;
            }
        }

        function parseColumnData(col1Input, col2Input) {
            const col1Lines = col1Input.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const col2Lines = col2Input.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            const maxLength = Math.max(col1Lines.length, col2Lines.length);
            const rows = [];
            
            for (let i = 0; i < maxLength; i++) {
                rows.push({
                    col1: col1Lines[i] || '',
                    col2: col2Lines[i] || '',
                    index: i
                });
            }
            
            return rows;
        }

        function rowsEqual(row1, row2) {
            return row1.col1 === row2.col1 && row1.col2 === row2.col2;
        }

        function autoSortTarget() {
            const sourceCol1 = document.getElementById('sourceCol1').value.trim();
            const sourceCol2 = document.getElementById('sourceCol2').value.trim();
            const targetCol1 = document.getElementById('targetCol1').value.trim();
            const targetCol2 = document.getElementById('targetCol2').value.trim();

            if (!sourceCol1 && !sourceCol2) {
                return;
            }

            if (!targetCol1 && !targetCol2) {
                return;
            }

            const sourceRows = parseColumnData(sourceCol1, sourceCol2);
            const targetRows = parseColumnData(targetCol1, targetCol2);

            const targetUsed = new Array(targetRows.length).fill(false);
            const autoSorted = [];
            
            sourceRows.forEach(sourceRow => {
                let foundIndex = -1;
                for (let i = 0; i < targetRows.length; i++) {
                    if (!targetUsed[i] && rowsEqual(targetRows[i], sourceRow)) {
                        foundIndex = i;
                        break;
                    }
                }
                
                if (foundIndex !== -1) {
                    autoSorted.push(targetRows[foundIndex]);
                    targetUsed[foundIndex] = true;
                } else {
                    autoSorted.push({
                        col1: '[MISSING FROM TARGET]',
                        col2: '[MISSING FROM TARGET]',
                        index: sourceRow.index
                    });
                }
            });

            const unusedTargetItems = [];
            for (let i = 0; i < targetRows.length; i++) {
                if (!targetUsed[i]) {
                    unusedTargetItems.push(targetRows[i]);
                }
            }

            const autoSortedCol1 = autoSorted.map(row => row.col1).join('\n');
            const autoSortedCol2 = autoSorted.map(row => row.col2).join('\n');
            
            document.getElementById('autoSortedCol1').value = autoSortedCol1;
            document.getElementById('autoSortedCol2').value = autoSortedCol2;
        }

        function compareData() {
            const sourceCol1 = document.getElementById('sourceCol1').value.trim();
            const sourceCol2 = document.getElementById('sourceCol2').value.trim();
            const autoSortedCol1 = document.getElementById('autoSortedCol1').value.trim();
            const autoSortedCol2 = document.getElementById('autoSortedCol2').value.trim();

            if ((!sourceCol1 && !sourceCol2) || (!autoSortedCol1 && !autoSortedCol2)) {
                return;
            }

            const sourceRows = parseColumnData(sourceCol1, sourceCol2);
            const autoSortedRows = parseColumnData(autoSortedCol1, autoSortedCol2);

            const maxLength = Math.max(sourceRows.length, autoSortedRows.length);
            
            const comparisons = [];
            let exactMatches = 0;
            let partialMatches = 0;
            let mismatches = 0;

            for (let i = 0; i < maxLength; i++) {
                const sourceRow = sourceRows[i] || { col1: '[MISSING]', col2: '[MISSING]' };
                const autoSortedRow = autoSortedRows[i] || { col1: '[MISSING]', col2: '[MISSING]' };
                
                let matchType = 'mismatch';
                let matchIcon = '✗';
                
                // Check if this row contains missing data
                const hasMissingData = sourceRow.col1.includes('[MISSING') || sourceRow.col2.includes('[MISSING') ||
                                     autoSortedRow.col1.includes('[MISSING') || autoSortedRow.col2.includes('[MISSING');
                
                if (hasMissingData) {
                    matchType = 'missing';
                    matchIcon = '?';
                    mismatches++;
                } else if (rowsEqual(sourceRow, autoSortedRow)) {
                    matchType = 'match';
                    matchIcon = '✓';
                    exactMatches++;
                } else if ((sourceRow.col1 === autoSortedRow.col1) || (sourceRow.col2 === autoSortedRow.col2)) {
                    matchType = 'partial-match';
                    matchIcon = '∼';
                    partialMatches++;
                } else {
                    mismatches++;
                }

                comparisons.push({
                    position: i + 1,
                    sourceRow: sourceRow,
                    autoSortedRow: autoSortedRow,
                    matchType: matchType,
                    matchIcon: matchIcon
                });
            }

            const matchPercentage = maxLength > 0 ? Math.round((exactMatches / maxLength) * 100) : 0;

            comparisonData = {
                sourceRows: sourceRows,
                autoSortedRows: autoSortedRows,
                comparisons: comparisons,
                stats: {
                    totalRows: maxLength,
                    exactMatches: exactMatches,
                    partialMatches: partialMatches,
                    mismatches: mismatches,
                    matchPercentage: matchPercentage
                }
            };

            displayResults();
        }

        function displayResults() {
            updateMetrics();
            updateComparison();
            
            const resultsEl = document.getElementById('results');
            resultsEl.classList.add('visible');
        }

        function updateMetrics() {
            const data = comparisonData;
            const metricsGrid = document.getElementById('metricsGrid');
            
            let statusClass = 'error';
            let statusText = 'Needs Review';
            
            if (data.stats.matchPercentage === 100) {
                statusClass = 'success';
                statusText = 'Perfect';
            } else if (data.stats.matchPercentage >= 75) {
                statusClass = 'warning';
                statusText = 'Good';
            }
            
            metricsGrid.innerHTML = `
                <div class="metric-card ${statusClass}">
                    <div class="metric-value">${statusText}</div>
                    <div class="metric-label">Status</div>
                </div>
                <div class="metric-card success">
                    <div class="metric-value">${data.stats.exactMatches}</div>
                    <div class="metric-label">Exact Matches</div>
                </div>
                <div class="metric-card warning">
                    <div class="metric-value">${data.stats.partialMatches}</div>
                    <div class="metric-label">Partial Matches</div>
                </div>
                <div class="metric-card error">
                    <div class="metric-value">${data.stats.mismatches}</div>
                    <div class="metric-label">Mismatches</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${data.stats.matchPercentage}%</div>
                    <div class="metric-label">Match Rate</div>
                </div>
            `;
        }

        function updateComparison() {
            const data = comparisonData;
            const comparisonContent = document.getElementById('comparisonContent');
            
            comparisonContent.innerHTML = data.comparisons.map(comp => `
                <div class="comparison-row ${comp.matchType}">
                    <div class="row-index">Row ${comp.position}</div>
                    <div class="data-container source">
                        <div class="data-header">Source</div>
                        <div class="data-grid">
                            <div class="data-cell primary">${comp.sourceRow.col1}</div>
                            <div class="data-cell secondary">${comp.sourceRow.col2}</div>
                        </div>
                    </div>
                    <div class="data-container target">
                        <div class="data-header">Auto-Sorted</div>
                        <div class="data-grid">
                            <div class="data-cell primary">${comp.autoSortedRow.col1}</div>
                            <div class="data-cell secondary">${comp.autoSortedRow.col2}</div>
                        </div>
                    </div>
                    <div class="status-indicator">${comp.matchIcon}</div>
                </div>
            `).join('');
        }

        function clearData() {
            ['sourceCol1', 'sourceCol2', 'targetCol1', 'targetCol2', 'autoSortedCol1', 'autoSortedCol2'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            document.getElementById('results').classList.remove('visible');
            comparisonData = {};
        }

        function showNotification(message, type = 'success') {
            // Simple alert for now - could be enhanced with toast notifications
            alert(message);
        }

        function copyComparisonResults() {
            if (!comparisonData.stats) {
                return;
            }

            const data = comparisonData;
            let output = 'VIZOR PREMIUM - COMPARISON RESULTS\n';
            output += '==================================\n\n';
            
            output += 'SUMMARY:\n';
            output += `Total Rows: ${data.stats.totalRows}\n`;
            output += `Exact Matches: ${data.stats.exactMatches}\n`;
            output += `Partial Matches: ${data.stats.partialMatches}\n`;
            output += `Mismatches: ${data.stats.mismatches}\n`;
            output += `Match Percentage: ${data.stats.matchPercentage}%\n\n`;
            
            output += 'DETAILED ANALYSIS:\n';
            output += 'Row\tSource Col1\tSource Col2\tTarget Col1\tTarget Col2\tMatch Type\n';
            data.comparisons.forEach(comp => {
                const matchType = comp.matchType === 'match' ? 'EXACT' : 
                                comp.matchType === 'partial-match' ? 'PARTIAL' : 
                                comp.matchType === 'missing' ? 'MISSING' : 'MISMATCH';
                output += `${comp.position}\t${comp.sourceRow.col1}\t${comp.sourceRow.col2}\t${comp.autoSortedRow.col1}\t${comp.autoSortedRow.col2}\t${matchType}\n`;
            });

            copyToClipboard(output);
        }

        function copyAutoSortedData() {
            const autoSortedCol1 = document.getElementById('autoSortedCol1').value;
            const autoSortedCol2 = document.getElementById('autoSortedCol2').value;
            
            if (!autoSortedCol1.trim() && !autoSortedCol2.trim()) {
                return;
            }

            const col1Lines = autoSortedCol1.split('\n');
            const col2Lines = autoSortedCol2.split('\n');
            const maxLength = Math.max(col1Lines.length, col2Lines.length);
            
            let output = 'VIZOR PREMIUM - AUTO-SORTED DATA\n';
            output += '================================\n\n';
            output += 'Col1\tCol2\n';
            
            for (let i = 0; i < maxLength; i++) {
                const col1 = col1Lines[i] || '';
                const col2 = col2Lines[i] || '';
                output += `${col1}\t${col2}\n`;
            }

            copyToClipboard(output);
        }

        function copyMismatchesOnly() {
            if (!comparisonData.comparisons) {
                return;
            }

            const mismatches = comparisonData.comparisons.filter(comp => comp.matchType === 'mismatch' || comp.matchType === 'missing');
            
            if (mismatches.length === 0) {
                return;
            }

            let output = 'VIZOR PREMIUM - MISMATCHES REPORT\n';
            output += '=================================\n\n';
            output += 'Row\tSource Col1\tSource Col2\tTarget Col1\tTarget Col2\n';
            
            mismatches.forEach(comp => {
                output += `${comp.position}\t${comp.sourceRow.col1}\t${comp.sourceRow.col2}\t${comp.autoSortedRow.col1}\t${comp.autoSortedRow.col2}\n`;
            });

            copyToClipboard(output);
        }

        function copyToClipboard(text) {
            try {
                navigator.clipboard.writeText(text).then(() => {
                    // Silent copy - no notification needed
                }).catch(() => {
                    fallbackCopyTextToClipboard(text);
                });
            } catch (error) {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        // Initialize app
        window.onload = function() {
            initTheme();
            ['sourceCol1', 'sourceCol2', 'targetCol1', 'targetCol2', 'autoSortedCol1', 'autoSortedCol2'].forEach(id => {
                document.getElementById(id).value = '';
            });
        };
    </script>
</body>
</html>
